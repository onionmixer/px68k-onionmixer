# Serial Port (RS-232C) 테스트 계획

## 개요

PX68K-onionmixer의 Host Serial Port 연결 기능에 대한 테스트 계획입니다.
X68000의 RS-232C 포트를 호스트 Linux PC의 시리얼 장치에 연결하는 기능을 검증합니다.

## 테스트 환경

### 필요 장비

1. **USB-Serial 어댑터** (권장)
   - FTDI FT232 기반 어댑터
   - CH340/CH341 기반 어댑터
   - CP2102 기반 어댑터

2. **Null Modem 케이블 또는 루프백 커넥터** (자가 테스트용)
   - TX-RX 크로스 연결
   - 루프백: TX→RX, RTS→CTS, DTR→DSR+DCD 연결

3. **실제 시리얼 장치** (선택)
   - 다른 PC의 시리얼 포트
   - 마이크로컨트롤러 (Arduino 등)
   - 시리얼 터미널 장치

### 소프트웨어 환경

- **호스트 OS**: Linux (Ubuntu/Debian 권장)
- **터미널 프로그램**: minicom, screen, picocom 중 하나
- **X68000 소프트웨어**: RS-232C를 사용하는 프로그램

---

## 테스트 케이스

### 1. 메뉴 UI 테스트

#### TC-1.1: 시리얼 장치 없을 때 메뉴 표시
**조건**: 호스트에 시리얼 장치가 연결되지 않은 상태
**절차**:
1. 에뮬레이터 실행
2. F12 메뉴 진입
3. SERIAL 메뉴 선택

**예상 결과**:
- `-- disconnect --` 표시
- `NOTHING` 표시
- 에뮬레이터 정상 동작

**결과**: [ ] Pass / [ ] Fail

---

#### TC-1.2: 시리얼 장치 있을 때 메뉴 표시
**조건**: USB-Serial 어댑터가 연결된 상태
**절차**:
1. USB-Serial 어댑터 연결
2. 에뮬레이터 실행
3. F12 → SERIAL 메뉴 선택

**예상 결과**:
- `-- disconnect --` 표시
- `/dev/ttyUSB0` (또는 해당 장치) 표시

**결과**: [ ] Pass / [ ] Fail

---

#### TC-1.3: 동적 장치 감지
**조건**: 에뮬레이터 실행 중
**절차**:
1. 에뮬레이터 실행 (USB-Serial 미연결)
2. F12 → SERIAL 확인 (NOTHING 표시)
3. ESC로 메뉴 종료
4. USB-Serial 어댑터 연결
5. F12 → SERIAL 다시 확인

**예상 결과**:
- 새로 연결된 장치가 목록에 표시됨

**결과**: [ ] Pass / [ ] Fail

---

#### TC-1.4: 장치 연결
**조건**: USB-Serial 어댑터 연결됨
**절차**:
1. F12 → SERIAL 메뉴
2. `/dev/ttyUSB0` 선택
3. Enter 키로 연결

**예상 결과**:
- 콘솔에 `Serial: Connected to /dev/ttyUSB0` 출력
- 메뉴에 `[/dev/ttyUSB0]` 표시

**결과**: [ ] Pass / [ ] Fail

---

#### TC-1.5: 장치 연결 해제
**조건**: 시리얼 장치가 연결된 상태
**절차**:
1. F12 → SERIAL 메뉴
2. `[/dev/ttyUSB0]` (현재 연결) 항목 선택
3. Enter 키로 연결 해제

**예상 결과**:
- 콘솔에 `Serial: Disconnected` 출력
- 메뉴에 `-- disconnect --` 표시

**결과**: [ ] Pass / [ ] Fail

---

### 2. 루프백 테스트

#### TC-2.1: 루프백 커넥터를 이용한 자가 통신 테스트
**조건**: 루프백 커넥터 (TX-RX 연결) 장착
**절차**:
1. USB-Serial + 루프백 커넥터 연결
2. 에뮬레이터에서 시리얼 연결
3. X68000에서 RS-232C 테스트 프로그램 실행
4. 문자 송신 테스트

**예상 결과**:
- 송신한 문자가 그대로 수신됨

**결과**: [ ] Pass / [ ] Fail

---

### 3. Human68K 테스트

#### TC-3.1: RS232C.SYS 드라이버 로드
**조건**: Human68K 부팅
**절차**:
1. CONFIG.SYS에 RS232C.SYS 추가 또는 DEVICE 명령 사용
2. Human68K 부팅
3. 드라이버 로드 확인

**예상 결과**:
- 드라이버 정상 로드
- 에뮬레이터 행업 없음

**결과**: [ ] Pass / [ ] Fail

---

#### TC-3.2: SPEED.X를 이용한 보드레이트 설정
**조건**: Human68K 부팅, RS232C.SYS 로드됨
**절차**:
1. `SPEED 9600` 실행
2. `SPEED 19200` 실행
3. `SPEED 38400` 실행

**예상 결과**:
- 각 보드레이트 설정 성공
- 에뮬레이터 정상 동작

**결과**: [ ] Pass / [ ] Fail

---

#### TC-3.3: COPY AUX: 테스트
**조건**: Human68K, 시리얼 연결됨, 루프백 또는 외부 장치
**절차**:
1. 호스트에서 minicom으로 해당 포트 열기
2. X68000에서 `COPY CON: AUX:` 실행
3. 문자 입력 후 Ctrl+Z

**예상 결과**:
- 입력한 문자가 호스트 minicom에 표시됨

**결과**: [ ] Pass / [ ] Fail

---

### 4. 외부 장치 통신 테스트

#### TC-4.1: PC간 Null Modem 통신
**조건**: 두 PC를 Null Modem 케이블로 연결
**절차**:
1. 호스트 PC에서 minicom 실행 (9600 8N1)
2. 에뮬레이터에서 시리얼 연결
3. X68000에서 터미널 프로그램 실행
4. 양방향 문자 송수신

**예상 결과**:
- 양방향 통신 성공

**결과**: [ ] Pass / [ ] Fail

---

#### TC-4.2: Arduino와 통신
**조건**: Arduino가 /dev/ttyACM0으로 연결됨
**절차**:
1. Arduino에 시리얼 에코 스케치 업로드
2. 에뮬레이터에서 /dev/ttyACM0 연결
3. X68000에서 문자 송신
4. 에코 응답 확인

**예상 결과**:
- Arduino로 전송한 데이터가 에코되어 돌아옴

**결과**: [ ] Pass / [ ] Fail

---

### 5. X68000 소프트웨어 테스트

#### TC-5.1: 통신 소프트웨어 실행
**조건**: X68000용 통신 소프트웨어 (예: WTERM, KERMIT 등)
**절차**:
1. 통신 소프트웨어 실행
2. 시리얼 포트 설정
3. 호스트의 터미널과 통신 시도

**예상 결과**:
- 소프트웨어 정상 실행
- 기본 통신 기능 동작

**결과**: [ ] Pass / [ ] Fail

---

### 6. 안정성 테스트

#### TC-6.1: 장시간 통신 테스트
**조건**: 시리얼 연결됨
**절차**:
1. 대량의 데이터 (1MB 이상) 송수신
2. 에뮬레이터 안정성 확인

**예상 결과**:
- 데이터 손실 없음
- 에뮬레이터 행업/크래시 없음

**결과**: [ ] Pass / [ ] Fail

---

#### TC-6.2: 장치 분리 시 동작
**조건**: 시리얼 연결 상태
**절차**:
1. 통신 중 USB-Serial 어댑터 물리적 분리
2. 에뮬레이터 동작 확인
3. F12 메뉴에서 상태 확인

**예상 결과**:
- 에뮬레이터 크래시 없음
- 이후 정상 동작

**결과**: [ ] Pass / [ ] Fail

---

#### TC-6.3: 시리얼 미연결 시 부팅 안정성
**조건**: 시리얼 장치 미연결
**절차**:
1. 에뮬레이터 실행
2. 다양한 X68000 소프트웨어 실행
3. RS-232C 관련 소프트웨어 실행 시도

**예상 결과**:
- 모든 경우에 에뮬레이터 정상 동작
- 부팅 에러 없음

**결과**: [ ] Pass / [ ] Fail

---

## 보드레이트 테스트 매트릭스

| 보드레이트 | 설정 | 송신 | 수신 | 비고 |
|-----------|------|------|------|------|
| 300       | [ ]  | [ ]  | [ ]  |      |
| 1200      | [ ]  | [ ]  | [ ]  |      |
| 2400      | [ ]  | [ ]  | [ ]  |      |
| 4800      | [ ]  | [ ]  | [ ]  |      |
| 9600      | [ ]  | [ ]  | [ ]  |      |
| 19200     | [ ]  | [ ]  | [ ]  |      |
| 38400     | [ ]  | [ ]  | [ ]  |      |

---

## 테스트 도구

### 루프백 커넥터 배선도 (DB-9)

```
Pin 2 (RX)  ←──→  Pin 3 (TX)
Pin 7 (RTS) ←──→  Pin 8 (CTS)
Pin 4 (DTR) ←──┬→ Pin 6 (DSR)
               └→ Pin 1 (DCD)
Pin 5 (GND) ────  GND
```

### minicom 설정 예시

```bash
# 설치
sudo apt install minicom

# 실행 (9600 8N1)
minicom -D /dev/ttyUSB0 -b 9600

# 또는 screen 사용
screen /dev/ttyUSB0 9600
```

### Arduino 에코 테스트 스케치

```cpp
void setup() {
    Serial.begin(9600);
}

void loop() {
    if (Serial.available()) {
        char c = Serial.read();
        Serial.write(c);  // Echo back
    }
}
```

---

## 알려진 제한 사항

1. **하드웨어 흐름 제어**: RTS/CTS 흐름 제어는 구현되어 있으나 테스트 필요
2. **고속 통신**: 38400bps 이상의 고속 통신은 타이밍 문제 발생 가능
3. **인터럽트 처리**: SCC 인터럽트 기반 통신의 정확한 타이밍 검증 필요

---

## 테스트 결과 요약

| 카테고리 | 총 테스트 | Pass | Fail | N/A |
|---------|----------|------|------|-----|
| 메뉴 UI | 5 | | | |
| 루프백 | 1 | | | |
| Human68K | 3 | | | |
| 외부 장치 | 2 | | | |
| X68K 소프트웨어 | 1 | | | |
| 안정성 | 3 | | | |
| **합계** | **15** | | | |

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2025-01 | 1.0 | 초기 테스트 계획 작성 |
