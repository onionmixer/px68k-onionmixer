ポータブルX68000エミュレータ
PX68K ( Portable (x)keropi PRO-68K )
                                                                     2025/01

いろいろなデバイスで X68000 エミュレータが動作したら楽しいな、
と思い立ち、この PX68K を作りはじめました。

「Portable」とは「移植しやすいよ」という意味です。
タブレット等のポータブルデバイスで動いたらいいな、
という意味もこめています。


PX68K は以下の成分からできています。

  けんじょさん (http://retropc.net/kenjo/) が
  作成された SHARP X68000エミュレータ WinX68k (通称けろぴー)

  NONAKA Kimihiro さん(http://www.asahi-net.or.jp/~aw9k-nnk/keropi/) が
  けろぴーを UNIX/X11 環境で動作する様に移植した xkeropi

  Stephane Dallongeville さんが開発したものを、
  NJ 氏が組み込んだ MC68000 MPU エミュレータ

  cisc 氏(cisc@retropc.net) が作成された FM/PSG 音源実装 fmgen
  (詳細は ソースリポジトリの fmgen/readme.txt を参照)
  PX68K への実装にあたり、以下の変更を行っています
  ・Sample 型を int32 から int16 に変更


0. 注意事項

  0.1 全機種共通

  ・マウス等、まだ未対応です。

  0.2 Android 版について

  ・Android 3.1 以上でないと動きません。

  0.3 Raspberry Pi (Raspbian) について

  ・自前でコンパイルしてください。
  ・コンパイルについては develop.txt を参照願います。
  ・その他については下記 Unix 版の章を参照してください。

  0.4 Mac OS X 版について

  ・とりあえず自前でコンパイルしてください。
  ・コンパイルについては develop.txt を参照願います。
  ・メニューを開くF12キーが、既に別のショートカットに割り当てられている
    場合は、システム環境設定の「キーボード」の「ショートカット」で解除して
    おいてください。
  ・その他については下記 Unix 版の章を参照してください。


1. 下準備

  ・BIOS ROM ファイルを用意してください。
    ファイル名は以下のいずれかで、小文字でも大文字でも構いません。

        iplrom.dat, iplrom30.dat, iplromco.dat, iplromxv.dat

    ※特に理由がなければ、iplrom30.datの使用はお勧めしません。
      HD イメージが読み込めない等の不具合報告があります。

  ・フォントファイルを用意してください。
    ファイル名は以下のいずれかで、小文字でも大文字でも構いません。

        cgrom.dat, cgrom.tmp

    フォントファイルがない場合は PC 上で WinX68k 高速版を実行すると、
    cgrom.tmp が生成されますので、それを使ってください。

  ・Human68K は立ち上がるけれど、ゲームが起動できない場合は
    標準のメモリ 1MB では動作しないゲームである可能性が高いです。

    HUMAN68K を起動後、キーボードまたはソフトウェアキーボードで
    「switch」と入力後リターンキーを押し、SWITCH.X コマンドを起動して
    メモリ設定してください。


2. Android 版について

  2.1 ファイルの配置について

  ・Android 版の場合は、/sdcard/px68k/ ディレクトリを作成し、
    BIOS ROM, フォントファイルを置きます。
    機種によっては、/sdcard ではなく、/sdcard0 だったりするかもしれません。
    その機種の内部ストレージっぽいところに px68k ディレクトリを
    作成してください。

  ・Android で、px68k ディレクトリを外部 SD カードに置きたい等、ディレクトリを
    自分で指定したい場合は、まず以下のディレクトリを探してください。
    内部ストレージは、/sdcard とかそういうところです。

        (内部ストレージ)/Android/data/conm.fc2.blog45.hissorii/files

    見つかったらそこに、dir.txtというファイルを作成し、ファイルの一行目に
    指定したいディレクトリを記述してください。例えば以下の様に。
        /mnt/sdcard/external_sd/px68k

    dir.txt を使う場合は、内部ストレージの px68k ディレクトリは
    削除しておいてください。内部ストレージ優先で読んでしまいます。

    px68k ディレクトリを移動した場合は、config ファイルを消した方がよいです。
    config に /sdcard/px68k/hoge.xdf とか古いイメージファイルの記述が
    残っていて、ディレクトリを移動後にアクセスしに行くと、
    多分 px68k がクラッシュします。

  ・エミュレータを開始してもすぐに終了してしまう場合は、これらのファイルの
    置き場所、ファイル名について見直してみてください。

  2.2 イメージファイルについて

  ・Android 版は /sdcard/px68k ディレクトリに
    イメージファイルを置いて下さい。
    サブディレクトリを作成し、その中にファイルを置くこともできます。

  ・読み込み対象となるファイルの拡張子は以下となります。

    .D88 .88D .HDM .DUP .2HD .DIM .XDF .IMG (FD イメージ)
    .HDF (HD イメージ)

  ・ ディレクトリを深く掘りすぎたり、長いファイル名の場合、UI 画面から
     はみ出すのは仕様です。

  2.3 メニュー UI

  ・イメージファイルの選択や各種設定には、メニュー UI を使用します。

  ・Android 版の場合、UI に入る、または抜けるには「メニューキー」を
    押すか、次項の白色ボタンを使用してください。

  ・右上隅の白色ボタンを長押し(0.3秒位)すると UI メニューに入ります。
    UI メニューから出るときにはもう一度白色ボタンを押してください。
    出るときは長押しは不要です。

  ・値の設定には「トリガー1ボタン」を使用します。
  ・値の解除には「トリガー2ボタン」を使用します。

  ・メニュー UI で設定した内容は、UI にて [SYSTEM]->[QUIT] を選択し、
    エミュレータを終了させたタイミングで保存されます。
    Android 版の場合は、バックキー(戻るキー)] を 2 回タップして
    エミュレータを終了させた場合も保存されます。

  ・設定を初期値に戻す場合は /sdcard/px68k/config ファイルを削除します。

  ・今のところ日本語ファイル名 (UTF-8) の表示が正しくできません。

  ・各設定の詳細は、「4. メニュー UI について」を参照してください。

  2.4 仮想ジョイスティック

  ・画面左側の D-pad っぽいのでスティック移動、画面右側のボタンっぽいのが
    トリガー1, 2に対応します。

  2.5 物理パッド

  ・PX68K を起動する前に、物理パッドを接続しておいてください。

  ・物理パッドが有効な場合、エミュレーション中の仮想ジョイスティックは
    表示されなくなります。
    メニューUI / ソフトウェアキーボード操作時は表示されます。

  ・物理パッドは X68000 のジョイスティック操作のほか、メニュー UI や
    ソフトウェアキーボード操作にも使用できます。

  ・ボタンの変更をしたい、使用するアナログパッドやデジタルパッドを指定したい
    場合は、メニュー UI の [HwJoy Setting] にて設定してください。

  2.6 キーボード

  ・画面右上隅の黄色ボタンを長押し(0.3秒位)するとソフトウェアキーボードが
    出現します。

  ・キーボードを指でなぞると、移動できます。

  ・キーボードを画面の右側に追いやるとソフトウェアキーボードが消えます。

  ・緑色の仮想キーを使って、キーボード上のキーを選択します。
    選択されたキーは黒色で表示されます。

  ・緑色の仮想ボタン(TRG1)を押すと、選択されたキーが入力されます。

  ・緑色の仮想ボタン(TRG2)を押すと、BS(Back Space)キーが入力されます。

  2.7 仮想マウス

  ・メニューで[Mouse]を選択すると仮想マウスが有効になります。

  ・仮想マウスと仮想パッドは排他です。

  ・画面全体がタッチパッドになるイメージでマウスカーソルを操作します。

  ・緑色のボタンが、マウスボタンになります。

  2.8 サウンド出力

  ・サンプリング周波数は 22050Hz 固定です。
    今のところ config に書いた値は反映されません。UI 実装時に考えます。
    現在 ADPCM と OPM のみ対応済みで、マーキュリーユニット、MIDI については
    未対応です。

  2.9 エミュレータの終了

  ・メニュー UI から終了してください。
  ・バックキー(戻るキー)を 2 回タップしても終了できます。


3. Unix 版について

  3.1 ファイルの配置について

  ・~/.keropi に BIOS ROM、フォントファイルを置いてください。

  3.2 イメージファイルについて

  ・実行ファイル px68k と同じ ディレクトリにイメージファイルを置いて下さい。
    サブディレクトリを作成し、その中にファイルを置くこともできます。

  ・読み込み対象となるファイルの拡張子は以下となります。

    .D88 .88D .HDM .DUP .2HD .DIM .XDF .IMG (FD イメージ)
    .HDF (HD イメージ)

  ・ ディレクトリを深く掘りすぎたり、長いファイル名の場合、UI 画面から
     はみ出すのは仕様です。

  ・以下の様に引数で指定することもできます。最初が FDD0, 次が FDD1 。

    $ ./px68k hoge.xdf hogege.xdf

  ・コマンドラインオプションも使用できます:

    --help          ヘルプを表示
    --iplrom PATH   IPL ROMファイルのパスを指定
    --cgrom PATH    CG ROMファイルのパスを指定
    --fdd0 PATH     FDDドライブ0のディスクイメージを指定
    --fdd1 PATH     FDDドライブ1のディスクイメージを指定
    --hdd0 PATH     HDDドライブ0のイメージを指定
    --hdd1 PATH     HDDドライブ1のイメージを指定

    例:
    $ ./px68k --iplrom iplrom.dat --cgrom cgrom.dat --fdd0 disk.xdf

  3.3 メニュー UI

  ・イメージファイルの選択や各種設定には、メニュー UI を使用します。

  ・UI に入る、または抜けるには [F12] キーを押してください。
  ・値の設定には [リターン] キーを使用します。
  ・値の解除には [ESC] キーを使用します。

  ・メニュー UI で設定した内容は、UI にて [SYSTEM]->[QUIT] を選択して
    エミュレータを終了させたタイミングで保存されます。

  ・Unix 版では、VKey/VBtn 関連の設定は反映されません。

  ・設定を初期値に戻す場合は ~/.keropi/config ファイルを削除します。

  ・Unix 版は今のところ日本語ファイル名 (UTF-8) の表示が正しくできません。

  ・各設定の詳細は、「4. メニュー UI について」を参照してください。

  3.4 ジョイスティック

  ・JoyKey モードを有効にすると、キーボードのカーソルキーでスティック移動、
    z キー、x キーがそれぞれトリガー 1, 2 に対応します。
    現在UIがないため、~/.keropi/config をエディタで修正する必要があります。

  3.5 キーボード

  ・PC の 10 キー部の NUMLOCK は X68000 では 10キーの CLR に対応します。
  ・PC の END は X68000 では UNDO に対応します。

  ・X68000 の COPY, かな, ローマ字, コード入力, CAPS, 記号入力, 登録,
    HELP, ひらがな, XF1, XF2, XF3, XF4, XF5, 全角 キーについては
    現在サポートしていません。

  3.6 サウンド出力

  ・サンプリング周波数は 22050Hz 固定です。
    今のところ config に書いた値は反映されません。UI 実装時に考えます。
    現在 ADPCM と OPM のみ対応済みで、マーキュリーユニット、MIDI については
    未対応です。


4. メニュー UI について

  ・メニューの階層と、それぞれの内容を以下に示します。
    設定キー、解除キーについては、各装置向けの説明を参照してください。

  [SYSTEM]-+-[RESET]
           |   エミュレータをリセットします。
           |   イメージファイルを選択した後は、これを実行します。
           |
           +-[NMI RESET]
           |   NMI リセットします。とりあえず使わないと思います。
           |
           +-[QUIT]
               エミュレータを終了します。
               UI で行った設定変更を保存します。

  [Joy/Mouse]-+-[Joystick]
              |    仮想パッドを有効にします。
              |
              +-[Mouse]
                   仮想マウスを有効にします。

  [FDD0]-+-[イメージファイル名] または [-- no disk --]
         |   イメージファイルを選択している場合はイメージファイル名が
         |   表示され、選択していない場合は no disk 表示となります。
	 |
         |   これを選択するとファイラモードに移行します。
         |   ファイラモードでは、設定キーでディレクトリの移動、
         |   イメージファイルの選択を行います。
         |   解除キーでファイラモードを終了します。
	 |
         +-[EJECT]
             イメージファイルを解除します。

  [FDD1]
           [FDD0] と同じです。
           ディスクドライブ2についての設定となります。

  [HDD0]
           [FDD0] と同じです。
           SASI HDD についての設定となります。

  [HDD1]
           [FDD0] と同じです。
           SASI HDD についての設定となります。
           HDD を 2 台以上接続する場合は、switch.x で HD_MAX の値を確認し、
           必要ならば変更してください。3 台以上の HDD を接続したい場合は
           config ファイルを直接編集してください。

  [Frame Skip]
           フレームスキップの設定をします。
           とりあえず Auto、とてつもなく早いマシンなら Full、
           遅いマシンは 1/2 -> ... -> 1/60 と変更してみてください。

  [Sound Rate]
           サウンドの出力周波数を設定します。
           値が大きいほど高音質になりますが、負荷がたかくなります。
           [No Sound] を選ぶと、音が鳴らなくなります。
           ※設定は次回起動時に有効になります

  [VKey Size]
           本設定は Android 版のみ有効です。
           仮想パッド、仮想ボタンの大きさを指定します。

  [VBtn Swap]-+
              |  本設定は Android版 のみ有効です。
              |  二つの仮想ボタンを入れ替えます。
              |  常にトリガー1が UI の設定キー、
              |  トリガー2が UI の解除キーとなるのでご注意ください。
	      |
              +-[TRG1 TRG2]
              |    画面上、左側がトリガー1、右側がトリガー2になります。
	      |
              +-[TRG2 TRG1]
                   画面上、左側がトリガー2、右側がトリガー1になります。

  [HwJoy Setting]-+-[Axis0(Left/Right):]
                  |   物理パッドの左右移動のパッドを設定します。
                  |   使用したい移動キーを左または右に動かしてください。
                  |   表示されている数字は現在の設定値です。
                  +-[Axis1(Up/Down):]
                  |   物理パッドの上下移動のパッドを設定します。
                  |   使用したい移動キーを上または下に動かしてください。
                  |   表示されている数字は現在の設定値です。
                  +-[Button0:]
                  |   物理パッドの TRG1 のボタンを設定します。
                  |   使用したいボタンを押してください
                  |   表示されている数字は現在の設定値です。
                  +-[Button1:]
                  |   物理パッドの TRG2 のボタンを設定します。
                  |   使用したいボタンを押してください
                  |   表示されている数字は現在の設定値です。
                  :
                  +-[Button7:]
                      物理パッドの TRG8 のボタンを設定します。
                      使用したいボタンを押してください
                      表示されている数字は現在の設定値です。

       ※項目を表示させた後、さらに選択ボタンを押すと設定モードにはいります。

  [No Wait Mode]
           [On] にすると同期をとらずに全速力で動きます。
           X68000 実機よりも早く動作してしまう場合があります。
           遅い装置で使うと効果があるかもしれません。
           通常は [Off] でよいです。

  [JoyKey]
           [On] にすると、物理キーボードのカーソルキーが Joystick の移動、
           z/x キーが Joystick のボタン代わりになります。


5. ToDo

  とりあえず、自分の予定と要望があったのを挙げてみました。
  他にもありましたら、blog のコメントでも Twitter でも構いませんので
  お知らせください。
  実現するかどうかは別ですが...

  以下は順不同です。

  ・実マウス対応
  ・仮想パッドのカスタマイズ (パッドの間を詰める?)
  ・物理キーボードのマッピングを手抜きしない (打てないキーをなくす)
  ・仮想キーボードの直接キータッチ対応
  ・ログメッセージ出力 (導入時、起動しない場合にあると便利)
  ・ファンタジーゾーン、サラマンダのショット音がおかしいのを修正 (難しい?)
  ・仮想ボタンデザイン
  ・menu/softkey のキーリピート
  ・utf-8なファイル名の表示 (iconv 使えない場合は面倒)
  ・性能改善


6. 免責

  本ソフトウェアを使用したことによる、いかなる損害も作者は責任を負いません。
  あくまでも自己責任での使用をお願い致します。


ひっそりぃ(hissorii)/sakahi
http://hissorii.blog45.fc2.com (ひっそりぃドットコム)
http://emuhani.seesaa.net      (えみゅはに - Emulator Hacking 日記)
GitHub: https://github.com/hissorii/px68k
Twitter: @hissorii_com
